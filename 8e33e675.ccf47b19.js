(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{63:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return s})),n.d(t,"metadata",(function(){return c})),n.d(t,"rightToc",(function(){return i})),n.d(t,"default",(function(){return b}));var a=n(2),o=n(6),r=(n(0),n(73)),s={id:"recipes",title:"Recipes"},c={unversionedId:"recipes",id:"recipes",isDocsHomePage:!1,title:"Recipes",description:"Local environment",source:"@site/docs/recipes.md",permalink:"/jyfti/docs/recipes",editUrl:"https://github.com/jyfti/jyfti/edit/master/website/docs/recipes.md",sidebar:"someSidebar",previous:{title:"The Jyfti Format",permalink:"/jyfti/docs/format"}},i=[{value:"Local environment",id:"local-environment",children:[]},{value:"Authentication",id:"authentication",children:[]}],l={rightToc:i};function b(e){var t=e.components,n=Object(o.a)(e,["components"]);return Object(r.b)("wrapper",Object(a.a)({},l,n,{components:t,mdxType:"MDXLayout"}),Object(r.b)("h2",{id:"local-environment"},"Local environment"),Object(r.b)("p",null,"If you develop or test workflows, you might not want to access the production systems.\nIn these cases, environments can be used to access test systems or mocks instead."),Object(r.b)("p",null,"Assuming there is an environment ",Object(r.b)("inlineCode",{parentName:"p"},"prod"),"."),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-json"}),'{\n  "baseUrl": "https://api.github.com"\n}\n')),Object(r.b)("p",null,"Then, there can be an environment ",Object(r.b)("inlineCode",{parentName:"p"},"local")," of the same structure."),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-json"}),'{\n  "baseUrl": "http://localhost:8080"\n}\n')),Object(r.b)("p",null,"The workflow can then define to use the base url from the environment."),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-json"}),'{\n  "$schema": "https://raw.githubusercontent.com/jyfti/jyfti/master/workflow-schema.json",\n  "name": "Retrieve the current status of the rate limit at GitHub",\n  "env": {\n    "baseUrl": {\n      "type": "string"\n    }\n  },\n  "output": {\n    "$eval": "rateLimit"\n  },\n  "steps": [\n    {\n      "assignTo": "rateLimit",\n      "request": {\n        "url": "${env.baseUrl}/rate_limit"\n      }\n    }\n  ]\n}\n')),Object(r.b)("p",null,"Via the environment option, a run can be started with one of these environments."),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-bash"}),"$ jyfti run -e prod\n$ jyfti run -e local\n")),Object(r.b)("p",null,"For the local environment, a technology such as ",Object(r.b)("a",Object(a.a)({parentName:"p"},{href:"https://www.mock-server.com/"}),"MockServer")," or ",Object(r.b)("a",Object(a.a)({parentName:"p"},{href:"http://www.mbtest.org/docs/gettingStarted"}),"Mountebank")," can be used to mock the http calls."),Object(r.b)("h2",{id:"authentication"},"Authentication"),Object(r.b)("p",null,"If you want to access protected APIs, you usually need to provide some form of credentials.\nThere are two ways to provide them without exposing them to the terminal history."),Object(r.b)("p",null,"They can be provided via inputs from environment variables."),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-bash"}),"$ jyfti run my-workflow $TOKEN\n")),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-json"}),'{\n  "$schema": "https://raw.githubusercontent.com/jyfti/jyfti/master/workflow-schema.json",\n  "inputs": {\n    "token": {\n      "type": "string"\n    }\n  },\n  ...\n}\n')),Object(r.b)("p",null,"They can also be provided via an environment file."),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-bash"}),"$ jyfti run my-workflow -e my-environment\n")),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-json"}),'{\n  "token": "<secret-token>"\n}\n')),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-json"}),'{\n  "$schema": "https://raw.githubusercontent.com/jyfti/jyfti/master/workflow-schema.json",\n  "env": {\n    "token": {\n      "type": "string"\n    }\n  },\n  ...\n}\n')),Object(r.b)("p",null,"In a workflow, the token can be accessed and added to a header."),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-json"}),'{\n  "$schema": "https://raw.githubusercontent.com/jyfti/jyfti/master/workflow-schema.json",\n  "name": "Retrieve the current status of the rate limit at GitHub",\n  "env": {\n    "token": {\n      "type": "string"\n    }\n  },\n  "steps": [\n    {\n      "assignTo": "rateLimit",\n      "request": {\n        "url": "https://api.github.com/rate_limit",\n        "headers": {\n          "Authorization": "token ${env.token}"\n        }\n      }\n    }\n  ]\n}\n')),Object(r.b)("p",null,"If you need to send the same headers multiple times, it is also possible to extract the header creation."),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-json"}),'{\n  "steps": [\n    {\n      "assignTo": "headers",\n      "expression": {\n        "Authorization": "token ${env.token}"\n      }\n    },\n    {\n      "assignTo": "rateLimit",\n      "request": {\n        "url": "https://api.github.com/rate_limit",\n        "headers": {\n          "$eval": "headers"\n        }\n      }\n    }\n  ]\n}\n')))}b.isMDXComponent=!0}}]);