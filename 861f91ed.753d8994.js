(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{63:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return i})),n.d(t,"metadata",(function(){return c})),n.d(t,"rightToc",(function(){return s})),n.d(t,"default",(function(){return u}));var o=n(2),r=n(6),a=(n(0),n(72)),i={id:"github-actions",title:"GitHub Actions"},c={unversionedId:"recipes/github-actions",id:"recipes/github-actions",isDocsHomePage:!1,title:"GitHub Actions",description:"You can run a Jyfti workflow on GitHub Actions.",source:"@site/docs/recipes/github-actions.md",permalink:"/jyfti/docs/recipes/github-actions",editUrl:"https://github.com/jyfti/jyfti/edit/master/website/docs/recipes/github-actions.md",sidebar:"someSidebar",previous:{title:"Authentication",permalink:"/jyfti/docs/recipes/authentication"}},s=[{value:"Secrets",id:"secrets",children:[]},{value:"Local execution",id:"local-execution",children:[]},{value:"Only save failures",id:"only-save-failures",children:[]}],l={rightToc:s};function u(e){var t=e.components,n=Object(r.a)(e,["components"]);return Object(a.b)("wrapper",Object(o.a)({},l,n,{components:t,mdxType:"MDXLayout"}),Object(a.b)("p",null,"You can run a Jyfti workflow on GitHub Actions.\nThis way, it is possible to run a workflow on a schedule or as a reaction to GitHub events.\nThe advantage of using Jyfti on GitHub Actions instead of plain GitHub Actions is that you gain the ability to run a workflow both locally as well as remotely.\nIt is even possible to retrieve the state of a Jyfti workflow from GitHub Actions and to locally debug it."),Object(a.b)("p",null,"A pure Jyfti workflow on GitHub Actions typically consists of five steps:"),Object(a.b)("ul",null,Object(a.b)("li",{parentName:"ul"},"Checking out the repo"),Object(a.b)("li",{parentName:"ul"},"Setting up node"),Object(a.b)("li",{parentName:"ul"},"Installing the Jyfti CLI"),Object(a.b)("li",{parentName:"ul"},"Running the workflow"),Object(a.b)("li",{parentName:"ul"},"Storing the Jyfti state artifact")),Object(a.b)("pre",null,Object(a.b)("code",Object(o.a)({parentName:"pre"},{className:"language-yaml"}),'name: Retrieve README\n\non:\n  schedule:\n    - cron: "0 10 * * *"\n  workflow_dispatch:\n\njobs:\n  workflow:\n    runs-on: ubuntu-latest\n\n    steps:\n      - uses: actions/checkout@v2\n\n      - name: Setup Node.js environment\n        uses: actions/setup-node@v2\n\n      - name: Install npm packages\n        run: npm install @jyfti/cli\n\n      - name: Run workflow\n        run: npx jyfti run https://raw.githubusercontent.com/jyfti/jyfti/master/workflows/retrieve-readme.json jyfti example-repo\n\n      - uses: actions/upload-artifact@v2\n        with:\n          name: jyfti-states\n          path: ./out\n')),Object(a.b)("h2",{id:"secrets"},"Secrets"),Object(a.b)("p",null,"For many you might want to pass secrets from the environment to the Jyfti workflow such that Jyfti can execute authenticated HTTP requests.\nAssuming that you have a GitHub environment holding your secrets, you can pass each field of a Jyfti environment as environment variable."),Object(a.b)("pre",null,Object(a.b)("code",Object(o.a)({parentName:"pre"},{className:"language-yaml"}),"jobs:\n  workflow:\n    runs-on: ubuntu-latest\n    environment: Slack\n    steps:\n      - ...\n      - name: Run workflow\n        env:\n          SLACK_WEBHOOK_URL: ${{ secrets.SLACK_WEBHOOK_URL }}\n        run: npx jyfti run --env-var slackWebhookUrl=SLACK_WEBHOOK_URL https://raw.githubusercontent.com/jyfti/jyfti/master/workflows/open-prs-to-slack.json jyfti example-repo\n")),Object(a.b)("p",null,"It is possible to pass nested fields like ",Object(a.b)("inlineCode",{parentName:"p"},"--env-var github.token=GITHUB_TOKEN"),"."),Object(a.b)("pre",null,Object(a.b)("code",Object(o.a)({parentName:"pre"},{className:"language-json"}),'{\n  "github": {\n    "token": "xxxxxxxxx"\n  }\n}\n')),Object(a.b)("p",null,"If there exists an environment file, then the passed environment variables overwrite the specific values of that file."),Object(a.b)("h2",{id:"local-execution"},"Local execution"),Object(a.b)("p",null,"If a Jyfti workflow has failed, you can inspect and re-execute it locally from the point where it failed.\nYou can use the ",Object(a.b)("inlineCode",{parentName:"p"},"github-artifact")," workflow to copy the remote workflow state into your local state directory. "),Object(a.b)("pre",null,Object(a.b)("code",Object(o.a)({parentName:"pre"},{}),"$ jyfti run https://raw.githubusercontent.com/jyfti/jyfti/master/workflows/github-artifact.json\n? The GitHub organization jyfti\n? The GitHub repository example-repo\n\u2714 Initialized\n\u2714 [0] Retrieve workflow runs\n\u2139 [1] Retrieve artifacts\n? The GitHub workflow run id 459006661\n\u2714 [1] Retrieve artifacts\n\u2714 [2] Retrieve artifact download url\n\u2714 [3] Download artifact\n\u2714 [4] Unzip artifact\n\u2714 [5] Remove zip file\nArchive:  artifact.zip\n  inflating: open-prs-to-slack.state.json\n")),Object(a.b)("p",null,"Then, you can proceed with the now local workflow state."),Object(a.b)("pre",null,Object(a.b)("code",Object(o.a)({parentName:"pre"},{}),"$ jyfti run status open-prs-to-slack\n$ jyfti run state open-prs-to-slack\n$ jyfti run complete open-prs-to-slack\n")),Object(a.b)("p",null,"Note that this only copies the workflow state and not the workflow itself.\nIt is recommended to store the workflows in git."),Object(a.b)("p",null,"If your CI environment passes environment variables to the Jyfti workflow, then you can either pass the environment variables locally as well or store them in your local environment file."),Object(a.b)("h2",{id:"only-save-failures"},"Only save failures"),Object(a.b)("p",null,"If a Jyfti workflow succeeds, you might not be interested in the workflow state and therefore don't store it.\nYou can do so via an if-condition in the GitHub Actions workflow."),Object(a.b)("pre",null,Object(a.b)("code",Object(o.a)({parentName:"pre"},{className:"language-yaml"}),"- uses: actions/upload-artifact@v2\n  if: ${{ failure() }}\n  with:\n    name: jyfti-states\n    path: ./out\n")))}u.isMDXComponent=!0},72:function(e,t,n){"use strict";n.d(t,"a",(function(){return p})),n.d(t,"b",(function(){return m}));var o=n(0),r=n.n(o);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function c(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,o,r=function(e,t){if(null==e)return{};var n,o,r={},a=Object.keys(e);for(o=0;o<a.length;o++)n=a[o],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(o=0;o<a.length;o++)n=a[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var l=r.a.createContext({}),u=function(e){var t=r.a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):c(c({},t),e)),n},p=function(e){var t=u(e.components);return r.a.createElement(l.Provider,{value:t},e.children)},f={inlineCode:"code",wrapper:function(e){var t=e.children;return r.a.createElement(r.a.Fragment,{},t)}},b=r.a.forwardRef((function(e,t){var n=e.components,o=e.mdxType,a=e.originalType,i=e.parentName,l=s(e,["components","mdxType","originalType","parentName"]),p=u(n),b=o,m=p["".concat(i,".").concat(b)]||p[b]||f[b]||a;return n?r.a.createElement(m,c(c({ref:t},l),{},{components:n})):r.a.createElement(m,c({ref:t},l))}));function m(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var a=n.length,i=new Array(a);i[0]=b;var c={};for(var s in t)hasOwnProperty.call(t,s)&&(c[s]=t[s]);c.originalType=e,c.mdxType="string"==typeof e?e:o,i[1]=c;for(var l=2;l<a;l++)i[l]=n[l];return r.a.createElement.apply(null,i)}return r.a.createElement.apply(null,n)}b.displayName="MDXCreateElement"}}]);